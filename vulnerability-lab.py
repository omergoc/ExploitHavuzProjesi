import requests
import pymongo
import bs4

class vulnerabilittLab:
    def __init__(self):
        self.client = pymongo.MongoClient('mongodb://localhost:27017/')
        self.db = self.client['THT']
        self.col = self.db['vulnerability-lab']

    def Script(self):
        resp = requests.get(
                'https://www.vulnerability-lab.com/',
                headers={'User-Agent': 'Mozilla/5.0'}
            ).text
        source = bs4.BeautifulSoup(resp,"lxml")
        sections = source.find_all('tr', {'class': 'submit'})
        for item in sections:
            exploit_link = item.find("td",{"class":"x14","width":"9","align":"center","nowrap":"nowrap"})
            for i in exploit_link:
                global exploitLink
                exploit_link = i.get("href")

            exploit_id = exploit_link.replace("download_content.php?id=","")
            exploit_date =item.find("td",{"class":"style14"}).text.strip()
            exploit_name=item.find("td",{"width":"375"}).text.strip()
            exploit_type=item.find("td",{"width":"50","align":"center"}).text.strip()
            exploit_author=item.find("td",{"nowrap":"nowrap","width":"135","align":"center"}).text.strip()

            if len(list(self.col.find({'exploit_id': exploit_id}))) == 0:

                data = {
                    "exploit_id":exploit_id,
                    "exploit_link":"https://www.vulnerability-lab.com/"+exploit_link,
                    "exploit_date":exploit_date,
                    "exploit_name":exploit_name,
                    "exploit_type":exploit_type,
                    "exploit_author":exploit_author,

                }
                self.col.insert_one(data)

if __name__ == '__main__':
    
    App = vulnerabilittLab()
    print("vulnerability-lab Exploit Bilgileri Ã‡ekiliyor.")
    App.Script()
